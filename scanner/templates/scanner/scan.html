{% extends "core/base.html" %}
{% block title %}Scan QR | PumpPay{% endblock title %}

{% block content %}
<div class="page-background">
    <div class="center-container">
        <div class="qr-card scan-card">
            <h1 class="card-title">üì∏ Scan QR Code for Payment</h1>

            <form action="{% url 'scan_qr' %}" method="post" enctype="multipart/form-data" class="scan-form">
                {% csrf_token %}
                
                <div class="input-group">
                    <label for="mobile_number" class="input-label">Your Mobile Number (Used for receipt/confirmation)</label>
                    <input type="text" id="mobile_number" name="mobile_number"
                           placeholder="Enter 10-digit mobile number"
                           required pattern="\d{10}"
                           class="form-input">
                </div>

                <div class="input-group file-upload-area">
                    <label for="qr_input" class="custom-file-label">
                        <span class="label-icon">üëÜ</span> Select QR Code Image
                    </label>
                    <input type="file" name="qr_image" accept="image/*" id="qr_input" class="hidden-file-input" required>
                </div>
                
                <div id="preview-container" class="preview-container" style="display: none;">
                    <img id="preview-img" class="preview-img" alt="QR Code Preview">
                </div>

                <button type="submit" class="scan-btn">
                    üîç Process & Pay
                </button>
            </form>

            {% if results %}
            <div class="results-area">
                <hr class="divider">
                <h2 class="results-heading">üí∞ Payment Details Found:</h2>
                <div class="results-content">{{ results }}</div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
// Updated JavaScript for the custom file input UX
document.getElementById('qr_input').addEventListener('change', function(event) {
    const file = event.target.files[0];
    const previewContainer = document.getElementById('preview-container');
    const previewImg = document.getElementById('preview-img');
    const fileLabel = document.querySelector('.custom-file-label');

    if (file) {
        // Update label text to show filename
        fileLabel.innerHTML = `<span class="label-icon">üñºÔ∏è</span> File selected: **${file.name}**`;

        const reader = new FileReader();
        reader.onload = function(e) {
            previewImg.src = e.target.result;

            // Show preview with animation
            previewContainer.style.display = "block";
            previewContainer.style.opacity = 0;
            previewContainer.style.transition = "opacity 0.4s ease";

            setTimeout(() => {
                previewContainer.style.opacity = 1;
            }, 50);
        };
        reader.readAsDataURL(file);
    } else {
        // Reset label and hide preview
        fileLabel.innerHTML = `<span class="label-icon">üëÜ</span> Select QR Code Image`;
        previewContainer.style.display = "none";
    }
});
</script>

{% endblock content %}

{% block extra_head %}
<style>
/* Base Styles */
.page-background {
    background: #f4f7f9; 
    padding: 50px 0;
    min-height: calc(100vh - 100px); 
}
.center-container {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding: 0 20px;
}

/* Card Styling */
.qr-card {
    background: #ffffff;
    padding: 40px;
    border-radius: 16px; 
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15); 
    width: 100%;
    max-width: 480px;
    text-align: center;
    border-top: 5px solid #1abc9c; /* Eye-catching yellow accent */
}

.card-title {
    font-size: 2rem;
    color: #2c3e50;
    margin-bottom: 30px;
    font-weight: 800;
}

/* Form Styling */
.scan-form {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

/* Input Grouping */
.input-group {
    text-align: left;
}
.input-label {
    display: block;
    font-size: 0.9rem;
    color: #555;
    margin-bottom: 5px;
    font-weight: 600;
}
.form-input {
    width: 100%;
    padding: 15px;
    border: 1px solid #dcdcdc;
    border-radius: 8px;
    font-size: 1rem;
    transition: all 0.3s ease;
    background: #f9f9f9; 
}
.form-input:focus {
    border-color: #1abc9c;
    background: #ffffff;
    outline: none;
    box-shadow: 0 0 0 4px rgba(26, 188, 156, 0.3); 
    transform: translateY(-1px); 
}

/* Custom File Input Styling */
.hidden-file-input {
    width: 0.1px;
    height: 0.1px;
    opacity: 0;
    overflow: hidden;
    position: absolute;
    z-index: -1;
}

.custom-file-label {
    display: block;
    padding: 15px;
    background: #1abc9c; /* Green background */
    color: white;
    font-size: 1.1rem;
    font-weight: 600;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 10px rgba(26, 188, 156, 0.3);
    text-align: center;
}

.custom-file-label:hover {
    background: #16a085;
    transform: scale(1.01);
}
.label-icon {
    margin-right: 8px;
    font-size: 1.2rem;
}

/* Scan Button Styling */
.scan-btn {
    padding: 15px;
    background: #ffd43b; /* Yellow Highlight */
    color: #2c3e50;
    font-size: 1.15rem;
    font-weight: 700;
    border: none;
    border-radius: 50px; 
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 15px;
    box-shadow: 0 4px 15px rgba(255, 212, 59, 0.4);
}

.scan-btn:hover {
    background: #ffc107;
    transform: scale(1.02); 
    box-shadow: 0 6px 20px rgba(255, 212, 59, 0.6);
}

/* Preview Container Styling */
.preview-container {
    margin-top: 15px;
    text-align: center;
    border: 2px dashed #cccccc;
    border-radius: 12px;
    padding: 15px;
    background: #fcfcfc;
}

.preview-img {
    max-width: 220px;
    border-radius: 8px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    border: 3px solid #1abc9c; /* Frame the image with the brand color */
}

/* Results Area Styling */
.results-area {
    margin-top: 30px;
    padding: 20px;
    background: #e9f7ef; /* Light green background for clarity */
    border-radius: 12px;
    border: 1px solid #1abc9c;
    text-align: left;
}
.divider {
    border: 0;
    height: 1px;
    background-color: #e0e0e0;
    margin: 30px 0;
}

.results-heading {
    font-size: 1.4rem;
    color: #16a085; 
    margin-bottom: 10px;
    font-weight: 700;
}
.results-content {
    font-size: 1rem;
    color: #333;
    white-space: pre-wrap; /* Keeps formatting if results are multiline */
}

/* Responsive adjustments */
@media (max-width: 550px) {
    .qr-card {
        padding: 30px 20px;
    }
    .preview-img {
        max-width: 180px;
    }
}
</style>
{% endblock extra_head %}